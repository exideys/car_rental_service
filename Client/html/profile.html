<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
</head>
<body>
    <li>Выводить все в таблицы Client(кроме Client id)</li>
    <li>Выводить с таюлицы Сlient_Evolution "rating and comments"</li>
    <h2>Профиль пользователя</h2>
    <p>Имя:   <span id="profile-name"></span></p>
    <p>Email: <span id="profile-email"></span></p>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {

        const cached = sessionStorage.getItem('user');
        if (cached) {
            renderProfile(JSON.parse(cached));
            return;
        }

        fetch('/api/auth/check_session.go')
            .then(r => r.json())
            .then(u => u.loggedIn ? renderProfile(u) : location.replace('/html/login.html'))
            .catch(console.error);
    });

    function renderProfile(user) {
        document.querySelector('#profile-name').textContent = user.username ?? (user.first_name + ' ' + user.last_name);
        document.querySelector('#profile-email').textContent = user.email;
        sessionStorage.setItem('user', JSON.stringify(user));
    }
</script>
</html>